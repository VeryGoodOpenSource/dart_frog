"use strict";(self.webpackChunkdart_frog_docs=self.webpackChunkdart_frog_docs||[]).push([[608],{2298:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"tutorials/counter","title":"\ud83d\udd22 Counter","description":"Build a simple \\"Counter\\" application.","source":"@site/docs/tutorials/counter.md","sourceDirName":"tutorials","slug":"/tutorials/counter","permalink":"/docs/tutorials/counter","draft":false,"unlisted":false,"editUrl":"https://github.com/VeryGoodOpenSource/dart_frog/tree/main/docs/docs/tutorials/counter.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"\ud83d\udd22 Counter","description":"Build a simple \\"Counter\\" application."},"sidebar":"docs","previous":{"title":"\ud83d\udd0a Echo","permalink":"/docs/tutorials/echo"},"next":{"title":"\ud83d\uddd2 Todos","permalink":"/docs/tutorials/todos"}}');var o=t(4848),s=t(8453);const i={sidebar_position:3,title:"\ud83d\udd22 Counter",description:'Build a simple "Counter" application.'},d="Counter \ud83d\udd22",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Creating a new app",id:"creating-a-new-app",level:2},{value:"Running the development server",id:"running-the-development-server",level:2},{value:"Updating the root route",id:"updating-the-root-route",level:2},{value:"Creating middleware",id:"creating-middleware",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"counter-",children:"Counter \ud83d\udd22"})}),"\n",(0,o.jsxs)(n.admonition,{type:"info",children:[(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Difficulty"}),": \ud83d\udfe2 Beginner",(0,o.jsx)("br",{}),"\n",(0,o.jsx)(n.strong,{children:"Length"}),": 15 minutes"]}),(0,o.jsxs)(n.p,{children:["Before getting started, ",(0,o.jsx)(n.a,{href:"/docs/overview#prerequisites",children:"read the prerequisites"})," to make sure your development environment is ready."]})]}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"In this tutorial, we're going to build an app that exposes a single endpoint and responds with the number of times the route was requested."}),"\n",(0,o.jsxs)(n.p,{children:["When we're done, we should be able to make multiple ",(0,o.jsx)(n.code,{children:"GET"})," requests to the ",(0,o.jsx)(n.code,{children:"/"})," endpoint:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# 1st time\ncurl --request GET \\\n  --url http://localhost:8080\n\n# 2nd time\ncurl --request GET \\\n  --url http://localhost:8080\n"})}),"\n",(0,o.jsx)(n.p,{children:"And our server should respond with the following responses:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"HTTP/1.1 200 OK\nConnection: close\nContent-Length: 21\nContent-Type: text/plain; charset=utf-8\n\n\nYou have requested this route 1 time(s).\n\n---\n\nHTTP/1.1 200 OK\nConnection: close\nContent-Length: 21\nContent-Type: text/plain; charset=utf-8\n\n\nYou have requested this route 2 time(s).\n"})}),"\n",(0,o.jsx)(n.h2,{id:"creating-a-new-app",children:"Creating a new app"}),"\n",(0,o.jsxs)(n.p,{children:["To create a new Dart Frog app, open your terminal, ",(0,o.jsx)(n.code,{children:"cd"})," into the directory where you'd like to create the app, and run the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"dart_frog create counter\n"})}),"\n",(0,o.jsx)(n.p,{children:"You should see an output similar to:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u2713 Creating counter (0.1s)\n\u2713 Installing dependencies (1.7s)\n\nCreated counter at ./counter.\n\nGet started by typing:\n\ncd ./counter\ndart_frog dev\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["Install and use the ",(0,o.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=VeryGoodVentures.dart-frog",children:"Dart Frog VS Code extension"})," to easily create Dart Frog apps within your IDE."]})}),"\n",(0,o.jsx)(n.h2,{id:"running-the-development-server",children:"Running the development server"}),"\n",(0,o.jsxs)(n.p,{children:["You should now have a directory called ",(0,o.jsx)(n.code,{children:"counter"})," -- ",(0,o.jsx)(n.code,{children:"cd"})," into it:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd counter\n"})}),"\n",(0,o.jsx)(n.p,{children:"Then, run the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"dart_frog dev\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This will start the development server on port ",(0,o.jsx)(n.code,{children:"8080"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u2713 Running on http://localhost:8080 (1.3s)\nThe Dart VM service is listening on http://127.0.0.1:8181/YKEF_nbwOpM=/\nThe Dart DevTools debugger and profiler is available at: http://127.0.0.1:8181/YKEF_nbwOpM=/devtools/#/?uri=ws%3A%2F%2F127.0.0.1%3A8181%2FYKEF_nbwOpM%3D%2Fws\n[hotreload] Hot reload is enabled.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Make sure it's working by opening ",(0,o.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})," in your browser or via ",(0,o.jsx)(n.code,{children:"cURL"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl --request GET \\\n  --url http://localhost:8080\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If everything succeeded, you should see ",(0,o.jsx)(n.code,{children:"Welcome to Dart Frog!"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"updating-the-root-route",children:"Updating the root route"}),"\n",(0,o.jsxs)(n.p,{children:["Now that we have a running application, let's start by updating the root route at ",(0,o.jsx)(n.code,{children:"routes/index.dart"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:dart_frog/dart_frog.dart';\n\nResponse onRequest(RequestContext context) {\n  const count = 1;\n  return Response(\n    body: 'You have requested this route $count time(s).',\n  );\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Save the changes and hot reload should kick in \u26a1\ufe0f"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"[hotreload] - Application reloaded.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Now if we visit ",(0,o.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})," in the browser or via ",(0,o.jsx)(n.code,{children:"cURL"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl --request GET \\\n  --url http://localhost:8080\n"})}),"\n",(0,o.jsx)(n.p,{children:"We should see our new response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"You have requested this route 1 time(s).\n"})}),"\n",(0,o.jsx)(n.p,{children:"Awesome! There's just one small issue..."}),"\n",(0,o.jsx)(n.p,{children:"Make another request and note that the count does not increment. This is expected because we hard-coded the count in our route handler. Let's fix that by introducing some middleware!"}),"\n",(0,o.jsx)(n.h2,{id:"creating-middleware",children:"Creating middleware"}),"\n",(0,o.jsx)(n.p,{children:"In Dart Frog, middleware allows you to execute code before and/or after a request is processed. In this example, we're going to create a piece of middleware that provides a count to our routes."}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["A piece of middleware can modify the inbound request and outbound responses, provide dependencies, and more! ",(0,o.jsx)(n.a,{href:"/docs/basics/middleware",children:"Learn more about middleware"}),"."]})}),"\n",(0,o.jsx)(n.p,{children:"For this example, we're going to create a single global piece of middleware but a Dart Frog application can consist of multiple pieces of middleware which are scoped to nested routes."}),"\n",(0,o.jsxs)(n.p,{children:["To create a global piece of middleware, we just need to create a file called ",(0,o.jsx)(n.code,{children:"_middleware.dart"})," in the ",(0,o.jsx)(n.code,{children:"routes"})," directory and define a ",(0,o.jsx)(n.code,{children:"middleware"})," method:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:dart_frog/dart_frog.dart';\n\n// This piece of middleware does nothing at the moment.\nHandler middleware(Handler handler) {\n  return handler;\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["Install and use the ",(0,o.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=VeryGoodVentures.dart-frog",children:"Dart Frog VS Code extension"})," to easily create new middleware within your IDE."]})}),"\n",(0,o.jsxs)(n.p,{children:["Now that we've defined the middleware, we can create our private ",(0,o.jsx)(n.code,{children:"count"})," and provide the count to all sub routes:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:dart_frog/dart_frog.dart';\n\nint _count = 0;\n\nHandler middleware(Handler handler) {\n  return handler.use(provider<int>((_) => ++_count));\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"use"})," method on a ",(0,o.jsx)(n.code,{children:"Handler"})," allows you to chain multiple ",(0,o.jsx)(n.code,{children:"middleware"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["In the above snippet, we are automatically incrementing the ",(0,o.jsx)(n.code,{children:"_count"})," whenever the value is read."]}),"\n",(0,o.jsx)(n.p,{children:"The last thing we need to do is update our route handler to use the provided count."}),"\n",(0,o.jsxs)(n.p,{children:["Open ",(0,o.jsx)(n.code,{children:"routes/index.dart"})," and replace the hard-coded count with the provided value using ",(0,o.jsx)(n.code,{children:"context.read"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'package:dart_frog/dart_frog.dart';\n\nResponse onRequest(RequestContext context) {\n  final count = context.read<int>();\n  return Response(\n    body: 'You have requested this route $count time(s).',\n  );\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"context.read<T>()"})," allows a route to access an instance of type ",(0,o.jsx)(n.code,{children:"T"})," which was provided via ",(0,o.jsx)(n.code,{children:"middleware"}),"."]})}),"\n",(0,o.jsx)(n.p,{children:"Be sure to save all the changes and hot reload should kick in \u26a1\ufe0f"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"[hotreload] - Application reloaded.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Now if we visit ",(0,o.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})," in the browser or via ",(0,o.jsx)(n.code,{children:"cURL"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl --request GET \\\n  --url http://localhost:8080\n"})}),"\n",(0,o.jsx)(n.p,{children:"We should see our response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"You have requested this route 1 time(s).\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now if we reload the page or make another request, the count should update:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"You have requested this route 2 time(s).\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"If you restart the server, the count will be reset to 0 because it is only maintained in memory."})}),"\n",(0,o.jsxs)(n.p,{children:["\ud83c\udf89 Congrats, you've created a ",(0,o.jsx)(n.code,{children:"counter"})," application using Dart Frog. View the ",(0,o.jsx)(n.a,{href:"https://github.com/VeryGoodOpenSource/dart_frog/tree/main/examples/counter",children:"full source code"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>d});var r=t(6540);const o={},s=r.createContext(o);function i(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);